<?xml version="1.0"?>
<odoo>
    <template id="smart_report_payslip" inherit_id="hr_payroll.report_payslip">

        <xpath expr="//h2[@id='payslip_name']" position="replace"> 
            <h2 class="text-center" id="payslip_name">Bulletin de salaire</h2>
        </xpath>

        <xpath expr="//div[@id='employee_id']" position="replace"> 
            <div id="employee_id">
                <strong class="me-2">ID:</strong>
                <span t-if="o.employee_id.matricule" t-field="o.employee_id.matricule"/>
                <span t-else="" style="color:#875A7B" class="fw-bold">No ID number on the employee !!!</span>
            </div>
        </xpath>

        <xpath expr="//div[@id='employee_marital']" position="replace"> 
            <div id="employee_marital" />
        </xpath>

        <xpath expr="//div[@id='employee_person_in_charge']" position="replace"> 
            <div id="employee_person_in_charge" />
        </xpath>

        <xpath expr="//div[@id='wage']" position="replace"> 
            <div id="wage">
                <!-- <strong class="me-2">Contract (<span class="text-capitalize" t-out="o.contract_id.wage_type"/>):</strong>
                <span t-out="o.contract_id._get_contract_wage()" t-options="{'widget': 'monetary', 'display_currency': o.company_id.currency_id}" style="color:#875A7B" class="fw-bold"/> -->
            </div>
        </xpath>

        <xpath expr="//div[@id='computed_on']" position="replace"> 
            <div id="computed_on">
                <strong class="me-2">Date:</strong>
                <span t-field="o.compute_date"/>
            </div>
        </xpath>

        <xpath expr="//div[@id='working_schedule']" position="replace"> 
            <div id="working_schedule">
                <!-- <strong class="me-2">Date:</strong>
                <span t-field="o.compute_date"/> -->
            </div>
        </xpath>

        <xpath expr="//div[@id='working_schedule']" position="after"> 
            <div id="days">
                <strong class="me-2">Présence:</strong>
                <span t-field="o.days" max="31"/>
            </div>
        </xpath> 

        <xpath expr="//div[@id='worked_days_table']" position="replace"> 
            <div id="worked_days_table"></div>
        </xpath>

        <xpath expr="//div[@id='worked_days_table']" position="after"> 
            <style>
                .table-fixed th:nth-child(1),
                .table-fixed td:nth-child(1) {
                    width: 40%;
                }

                .table-fixed th:nth-child(2),
                .table-fixed td:nth-child(2) {
                    width: 20%;
                }

                .table-fixed th:nth-child(3),
                .table-fixed td:nth-child(3) {
                    width: 20%;
                }

                .table-fixed th:nth-child(4),
                .table-fixed td:nth-child(4) {
                    width: 20%;
                }

                tr.no-border td {
                    border: none !important;
                    background-color: transparent !important;
                }
            </style>
            <div id="salaire"> 
                <!-- <div style="border: 1px solid; display: inline-block; padding: 0.25rem 0.5rem; padding-left: 12px; padding-right: 12px;">
                    <h4 class="m-0"></h4>
                </div> -->

                <div id="salary_table">
                    <table class="table table-sm table-borderless table-fixed">
                        <thead class="o_black_border">
                            <tr>
                                <th id="work_days_header_name">Salaire</th>
                                <th id="work_days_header_hours" t-attf-class="#{line_class} text-end" t-att-style="line_style">Taux</th>
                                <th id="work_days_header_days" t-attf-class="#{line_class} text-end" t-att-style="line_style">Gain</th>
                                <th id="work_days_header_amount" t-attf-class="#{line_class} text-end" t-att-style="line_style">Retenue</th>
                            </tr>
                        </thead>
                        <tbody id="worked_days_lines_salaire">
                            <tr t-foreach="o.line_ids.filtered(lambda line: line.appears_on_payslip and (line.code == 'SB-C' or line.code == 'SS-C' or line.code == 'IL-C' or line.code=='IT-C' or line.code == 'PR-C' or line.code == 'PF-C'))" t-as="line">
                                <td id="payslip_line_name">
                                    <span t-field="line.name"/>
                                </td>
                                <td id="payslip_line_rate" t-attf-class="#{line_class} text-end" t-att-style="line_style"></td>
                                <td id="payslip_line_gain" t-attf-class="#{line_class} text-end" t-att-style="line_style">
                                    <span t-out="line.amount"
                                        t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>
                                </td>
                                <td id="payslip_line_retenue" t-attf-class="#{line_class} text-end" t-att-style="line_style">
                                    
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="d-flex justify-content-end mt-2" style="width: 100%;">
                        <div style="width: 60%;"></div> <!-- Espace vide pour les deux premières colonnes -->
                        <div style="width: 20%; text-align: end; font-weight: bold;">
                            <span t-out="sum(o.line_ids.filtered(lambda line: line.appears_on_payslip and (line.code == 'SB-C' or line.code == 'SS-C' or line.code == 'IL-C' or line.code=='IT-C' or line.code == 'PR-C' or line.code == 'PF-C')).mapped('amount'))"
                                  t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>
                        </div>
                        <div style="width: 20%;"></div> <!-- Dernière colonne vide (Retenue) -->
                    </div>
                </div>
            </div>
            <div id="cotisation"> 
                <!-- <div style="border: 1px solid; display: inline-block; padding: 0.25rem 0.5rem; padding-left: 12px; padding-right: 12px;">
                    <h4 class="m-0"></h4>
                </div> -->
                <div id="salary_table">
                    <table class="table table-sm table-borderless table-fixed">
                        <thead class="o_black_border">
                            <tr>
                                <th id="work_days_header_name">Cotisation</th>
                                <th id="work_days_header_hours" t-attf-class="#{line_class} text-end" t-att-style="line_style">Taux</th>
                                <th id="work_days_header_days" t-attf-class="#{line_class} text-end" t-att-style="line_style">Gain</th>
                                <th id="work_days_header_amount" t-attf-class="#{line_class} text-end" t-att-style="line_style">Retenue</th>
                            </tr>
                        </thead>
                        <tbody id="worked_days_lines_cnss">
                            <tr t-foreach="o.line_ids.filtered(lambda line: line.appears_on_payslip and (line.code == 'CNSS' or line.code == 'CNAM'))" t-as="line">
                                <td id="payslip_line_name">
                                    <span t-field="line.name"/>
                                </td>
                                <td id="payslip_line_rate" t-attf-class="#{line_class} text-end" t-att-style="line_style"></td>
                                <td id="payslip_line_gain" t-attf-class="#{line_class} text-end" t-att-style="line_style">
                                    
                                </td>
                                <td id="payslip_line_retenue" t-attf-class="#{line_class} text-end" t-att-style="line_style">
                                    <span t-out="line.amount"
                                        t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="d-flex justify-content-end mt-2" style="width: 100%;">
                        <div style="width: 60%;"></div>
                        <div style="width: 20%;"></div> 
                        <div style="width: 20%; text-align: end; font-weight: bold;">
                            <span t-out="sum(o.line_ids.filtered(lambda line: line.appears_on_payslip  and (line.code == 'CNSS' or line.code == 'CNAM')).mapped('amount'))"
                                  t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>
                        </div>
                    </div>
                </div>
            </div>
            <div id="impot"> 
                <!-- <div style="border: 1px solid; display: inline-block; padding: 0.25rem 0.5rem; padding-left: 12px; padding-right: 12px;">
                    <h4 class="m-0"></h4>
                </div> -->
                <div id="salary_table">
                    <table class="table table-sm table-borderless table-fixed">
                        <thead class="o_black_border">
                            <tr>
                                <th id="work_days_header_name">Impots</th>
                                <th id="work_days_header_hours" t-attf-class="#{line_class} text-end" t-att-style="line_style">Taux</th>
                                <th id="work_days_header_days" t-attf-class="#{line_class} text-end" t-att-style="line_style">Gain</th>
                                <th id="work_days_header_amount" t-attf-class="#{line_class} text-end" t-att-style="line_style">Retenue</th>
                            </tr>
                        </thead>
                        <tbody id="worked_days_lines_impot">
                            <tr t-foreach="o.line_ids.filtered(lambda line: line.appears_on_payslip and line.code == 'ITS')" t-as="line">
                                <td id="payslip_line_name">
                                    <span t-field="line.name"/>
                                </td>
                                <td id="payslip_line_rate" t-attf-class="#{line_class} text-end" t-att-style="line_style"></td>
                                <td id="payslip_line_gain" t-attf-class="#{line_class} text-end" t-att-style="line_style">
                                    
                                </td>
                                <td id="payslip_line_retenue" t-attf-class="#{line_class} text-end" t-att-style="line_style">
                                    <span t-out="line.amount"
                                        t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="d-flex justify-content-end mt-2" style="width: 100%;">
                        <div style="width: 60%;"></div>
                        <div style="width: 20%;"></div> 
                        <div style="width: 20%; text-align: end; font-weight: bold;">
                            <span t-out="sum(o.line_ids.filtered(lambda line: line.appears_on_payslip  and (line.code == 'ITS')).mapped('amount'))"
                                  t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>
                        </div>
                    </div>
                </div>
            </div>
            <div id="prime"> 
                <!-- <div style="border: 1px solid; display: inline-block; padding: 0.25rem 0.5rem; padding-left: 12px; padding-right: 12px;">
                    <h4 class="m-0"></h4>
                </div> -->
                <div id="salary_table">
                    <table class="table table-sm table-borderless table-fixed">
                        <thead class="o_black_border">
                            <tr>
                                <th id="work_days_header_name">Primes</th>
                                <th id="work_days_header_hours" t-attf-class="#{line_class} text-end" t-att-style="line_style">Taux</th>
                                <th id="work_days_header_days" t-attf-class="#{line_class} text-end" t-att-style="line_style">Gain</th>
                                <th id="work_days_header_amount" t-attf-class="#{line_class} text-end" t-att-style="line_style">Retenue</th>
                            </tr>
                        </thead>
                        <tbody id="worked_days_lines_prime">
                            <tr t-foreach="o.line_ids.filtered(lambda line: line.appears_on_payslip and line.code in ['PPYV', 'PRCH', 'PPRJ', 'CG1'])" t-as="line">
                                <td id="payslip_line_name">
                                    <span t-field="line.name"/>
                                </td>
                                <td id="payslip_line_rate" t-attf-class="#{line_class} text-end" t-att-style="line_style"></td>
                                <td id="payslip_line_gain" t-attf-class="#{line_class} text-end" t-att-style="line_style">
                                    <span t-out="line.amount"
                                        t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>
                                </td>
                                <td id="payslip_line_retenue" t-attf-class="#{line_class} text-end" t-att-style="line_style">
                                    
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="d-flex justify-content-end mt-2" style="width: 100%;">
                        <div style="width: 60%;"></div>
                        <div style="width: 20%; text-align: end; font-weight: bold;">
                            <span t-out="sum(o.line_ids.filtered(lambda line: line.appears_on_payslip  and line.code in ['PPYV', 'PRCH', 'PPRJ', 'CG1']).mapped('amount'))"
                                  t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>
                        </div>
                        <div style="width: 20%;"></div> 
                    </div>
                </div>
            </div>
            <div id="retenue"> 
                <!-- <div style="border: 1px solid; display: inline-block; padding: 0.25rem 0.5rem; padding-left: 12px; padding-right: 12px;">
                    <h4 class="m-0"></h4>
                </div> -->
                <div id="salary_table">
                    <table class="table table-sm table-borderless table-fixed">
                        <thead class="o_black_border">
                            <tr>
                                <th id="work_days_header_name">Retenue</th>
                                <th id="work_days_header_hours" t-attf-class="#{line_class} text-end" t-att-style="line_style">Taux</th>
                                <th id="work_days_header_days" t-attf-class="#{line_class} text-end" t-att-style="line_style">Gain</th>
                                <th id="work_days_header_amount" t-attf-class="#{line_class} text-end" t-att-style="line_style">Retenue</th>
                            </tr>
                        </thead>
                        <tbody id="worked_days_lines_retenu">
                            <tr t-foreach="o.line_ids.filtered(lambda line: line.appears_on_payslip and (line.code == 'PRET' or line.code == 'AVN'))" t-as="line">
                                <td id="payslip_line_name">
                                    <span t-field="line.name"/>
                                </td>
                                <td id="payslip_line_rate" t-attf-class="#{line_class} text-end" t-att-style="line_style"></td>
                                <td id="payslip_line_gain" t-attf-class="#{line_class} text-end" t-att-style="line_style">
                                    
                                </td>
                                <td id="payslip_line_retenue" t-attf-class="#{line_class} text-end" t-att-style="line_style">
                                    <span t-out="line.amount"
                                        t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="d-flex justify-content-end mt-2" style="width: 100%;">
                        <div style="width: 60%;"></div>
                        <div style="width: 20%;"></div> 
                        <div style="width: 20%; text-align: end; font-weight: bold;">
                            <span t-out="sum(o.line_ids.filtered(lambda line: line.appears_on_payslip  and (line.code == 'PRET' or line.code == 'AVN')).mapped('amount'))"
                                  t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>
                        </div>
                    </div>
                </div>
            </div>
            <div id="other"> 
                <!-- <div style="border: 1px solid; display: inline-block; padding: 0.25rem 0.5rem; padding-left: 12px; padding-right: 12px;">
                    <h4 class="m-0"></h4>
                </div> -->
                <div id="other_table">
                    <table class="table table-sm table-borderless table-fixed">
                        <thead class="o_black_border">
                            <tr>
                                <th id="work_days_header_name">Autres attachements</th>
                                <th id="work_days_header_hours" t-attf-class="#{line_class} text-end" t-att-style="line_style">Taux</th>
                                <th id="work_days_header_days" t-attf-class="#{line_class} text-end" t-att-style="line_style">Gain</th>
                                <th id="work_days_header_amount" t-attf-class="#{line_class} text-end" t-att-style="line_style">Retenue</th>
                            </tr>
                        </thead>
                        <tbody id="worked_days_lines_autre">
                            <tr t-foreach="o.line_ids.filtered(lambda line: line.appears_on_payslip and line.code in ['RPPL', 'MSSN', 'ALLC', 'MTVT', 'CMMSS'])" t-as="line">
                                <td id="payslip_line_name">
                                    <span t-field="line.name"/>
                                </td>
                                <td id="payslip_line_rate" t-attf-class="#{line_class} text-end" t-att-style="line_style"></td>
                                <td id="payslip_line_gain" t-attf-class="#{line_class} text-end" t-att-style="line_style">
                                    <span t-out="line.amount"
                                        t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>
                                </td>
                                <td id="payslip_line_retenue" t-attf-class="#{line_class} text-end" t-att-style="line_style">
                                    
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="d-flex justify-content-end mt-2" style="width: 100%;">
                        <div style="width: 60%;"></div>
                        <div style="width: 20%; text-align: end; font-weight: bold;">
                            <span t-out="sum(o.line_ids.filtered(lambda line: line.appears_on_payslip  and line.code in ['RPPL', 'MSSN', 'ALLC', 'MTVT', 'CMMSS']).mapped('amount'))"
                                  t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>
                        </div>
                        <div style="width: 20%;"></div> 
                    </div>
                    
                    <div t-attf-class="#{line_class} text-end" style="margin-top : 30px; margin-bottom: 30px; font-size: 20px"> 
                        <span> Net à payer </span>
                        <strong>
                            <span t-out="sum(o.line_ids.filtered(lambda line: line.appears_on_payslip and line.code in ['SB-C', 'SS-C', 'IL-C', 'IT-C', 'PR-C', 'PF-C', 'PPYV', 'PRCH', 'PPRJ', 'CG1', 'PRET', 'AVN','RPPL', 'MSSN', 'ALLC', 'MTVT', 'CMMSS']).mapped('amount'))"
                                        t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>
                        </strong>
                    </div>
                </div>
            </div>
        </xpath>

        <xpath expr="//div[@id='payslip_lines_table']" position="replace"> 
            <div id="payslip_lines_table" />
        </xpath>
    </template>
</odoo>