<odoo>
    <data>
        <template id="custom_salary_report__payslip_banques">
            <t t-call="web.html_container">
                <t t-call="web.basic_layout">
                    <div> 
                        <div style="width: 100%; font-size: 18px;">
                                <div style="float: left;">933/03/MRB/ST/2025</div>
                                <div style="float: right;">
                                    Nouakchott, <span t-esc="time.strftime('%d-%m-%Y')"/>
                                </div>
                                <div style="clear: both;"></div>
                            </div>
                            <t t-if="virement.bank_id">
                                <h2 class="text-center mt-0">
                                    <span t-esc="virement.bank_id.name" /> - Nouakchott
                                </h2>
                            </t>

                            <br/>
 
                            <p>
                                <span>Objet: </span>
                                <span t-esc="virement.objet" />
                                <!-- <span t-esc="bank_info['payslips'][0].date_from"/>
                                <strong>au </strong>
                                <span t-esc="bank_info['payslips'][0].date_to"/> -->
                            </p>
                            <p>
                                Veuillez débiter notre compte N°  <strong t-esc="virement.compte" /> ouvert dans vos livres, par un montant de :
                                <strong t-esc="virement.montant_chiffre" /> (<strong t-esc="virement.montant_lettre" />)  Représentant le Paiement de <span t-esc="virement.objet" /> de l'année <span t-esc="time.strftime('%Y')"/>. 
                            </p>
                            <div class="oe_structure"></div>
                    </div>
                    <t t-foreach="bank_data" t-as="bank_info">
                        <div class="page">
                            <table class="table table-bordered table-sm" style="border-collapse: collapse; width: 100%;">
                                <thead>
                                    <tr>
                                        <th style="text-align: left; border: 1px solid black;">Matricule</th>
                                        <th style="text-align: left; border: 1px solid black;">NNI</th>
                                        <th style="text-align: left; border: 1px solid black;">Nom</th>
                                        <th style="text-align: left; border: 1px solid black;">Banque</th>
                                        <th style="text-align: left; border: 1px solid black;">N° de compte</th>
                                        <th style="text-align: left; border: 1px solid black;">Net à payer</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr t-foreach="bank_info['payslips']" t-as="line">
                                        <td style="text-align: left; border: 1px solid black;">
                                            <span t-out="line.employee_id.l10n_mr_matricule"/>
                                        </td>
                                        <td style="text-align: left; border: 1px solid black;">
                                            <span t-out="line.employee_id.identification_id"/>
                                        </td>
                                        <td style="text-align: left; border: 1px solid black;">
                                            <span t-out="line.employee_id.name"/>
                                        </td>
                                        <td style="text-align: left; border: 1px solid black;">
                                            <span t-out="line.employee_id.primary_bank_account_id.bank_id.name"/>
                                        </td>
                                        <td style="text-align: left; border: 1px solid black;">
                                            <span t-out="line.employee_id.primary_bank_account_id.acc_number"/>
                                        </td>
                                        <td style="text-align: left; border: 1px solid black;">
                                            <span t-out="line.line_ids.filtered(lambda l: l.code == 'NET').amount"/>
                                        </td>
                                    </tr>
                                    <!-- Ligne de total pour cette banque -->
                                    <tr>
                                        <td style="text-align: left; font-weight: bold; border: 1px solid black;">
                                            <span t-esc="len(bank_info['payslips'])"/>
                                        </td>
                                        <td colspan="4" style="text-align: left; font-weight: bold; border: 1px solid black;">Total Net</td>
                                        <td style="text-align: left; font-weight: bold; border: 1px solid black;">
                                            <span t-esc="sum(line.line_ids.filtered(lambda l: l.code == 'NET').amount for line in bank_info['payslips'])"
                                                t-options="{'widget': 'monetary', 'display_currency': bank_info['payslips'][0].currency_id}"/>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <br/>
                            
                        </div>                       <!-- Page break after each bank -->
                    </t>
                    <div class="row h6">
                        <div class="col-8">
                            <strong>
                                <span> Arrêté le present virement à la somme de : <span t-esc="virement.montant_chiffre" /> <br/>
                                <strong t-esc="virement.montant_lettre" /> <br/>
                                La Directrice financière <br/>
                                DIALIKA KORERA
                                </span>
                            </strong>
                        </div>
                        <div class="col-4 text-right">
                            <strong>
                                <span> Le Directeur général </span>
                            </strong>
                        </div>
                    </div>
                </t>
            </t>
        </template>
    </data>
</odoo>
