<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Vue formulaire du wizard - Étape 1 : Informations du lot -->
    <record id="view_bank_transfer_batch_wizard_step1_form" model="ir.ui.view">
        <field name="name">bank.transfer.batch.wizard.step1.form</field>
        <field name="model">bank.transfer.batch.wizard.step1</field>
        <field name="arch" type="xml">
            <form string="Créer un lot de virement bancaire">
                <sheet>
                    <group>
                        <group>
                            <label for="name" string="Nom du lot"/>
                            <div class="o_row">
                                <field name="name" placeholder="Ex: Lot Janvier 2025" class="oe_inline"/>
                            </div>
                        </group>
                        <group>
                            <label for="date" string="Date du lot"/>
                            <div class="o_row">
                                <field name="date" class="oe_inline"/>
                            </div>
                        </group>
                    </group>

                    <!-- Pleine largeur en bas -->
                    <group col="1">
                        <field name="source_currency_id" string="Devise source" class="w-100"/>
                    </group>

                    <group col="2">
                        <field name="transfer_type"/>
                        <field name="source_account_id" options="{'no_create': True, 'no_quick_create': True}"/>
                    </group>

                    <group col="1">
                        <field name="description" placeholder="Motif du virement..." class="w-100"/>
                    </group>
                </sheet>
                <footer>
                    <button string="Suivant" name="action_next" type="object" class="btn-primary" />
                    <button string="Annuler" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Vue formulaire du wizard - Étape 2 : Sélection des employés -->
    <record id="view_bank_transfer_batch_wizard_step2_form" model="ir.ui.view">
        <field name="name">bank.transfer.batch.wizard.step2.form</field>
        <field name="model">bank.transfer.batch.wizard.step2</field>
        <field name="arch" type="xml">
            <form string="Sélectionner les employés">
                <sheet>
                    
                    <!-- Résumé du lot -->
                    <group>
                        <group string="Informations du lot">
                            <field name="name" readonly="1" class="fw-bold"/>
                            <field name="date" readonly="1"/>
                            <field name="source_currency_id" readonly="1"/>
                            <field name="transfer_type" readonly="1"/>
                        </group>
                        <group string="Statistiques">
                            <label for="employee_count" string="Employés sélectionnés"/>
                            <div class="o_row">
                                <field name="employee_count" readonly="1" class="fw-bold text-primary"/>
                                <span class="text-muted ms-1">employé(s)</span>
                            </div>
                        </group>
                    </group>
                    
                    <separator string="Cochez les employés à inclure dans le lot"/>
                    
                    <div class="alert alert-info mb-3" role="alert">
                        <i class="fa fa-users"/> Liste des employés avec un contrat actif (hr.version). Cochez ceux à inclure dans le lot.
                    </div>

                    <group>
                        <group string="Compte source / Motif">
                            <field name="source_account_id" readonly="1"/>
                            <field name="description" readonly="1"/>
                        </group>
                    </group>
                    
                    <!-- Liste des employés avec cases à cocher -->
                    <field name="employee_line_ids" nolabel="1">
                        <list editable="bottom" create="false" delete="false">
                            <field name="selected" widget="boolean_toggle"/>
                            <field name="matricule" readonly="1"/>
                            <field name="employee_name" readonly="1"/>
                            <field name="job_title" readonly="1"/>
                            <field name="version_id" readonly="1"/>
                        </list>
                    </field>
                    
                    <div class="alert alert-warning mt-3" role="alert" invisible="employee_count == 0">
                        <i class="fa fa-exclamation-triangle"/> Vous allez créer <strong><field name="employee_count" readonly="1" class="d-inline"/></strong> virement(s) bancaire(s).
                    </div>
                </sheet>
                <footer>
                    <button string="Créer le lot" 
                            name="action_create_batch" 
                            type="object" 
                            class="btn-primary" 
                            icon="fa-check"
                            invisible="employee_count == 0"/>
                    <button string="Annuler" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Action pour ouvrir le wizard étape 1 -->
    <record id="action_bank_transfer_batch_wizard_step1" model="ir.actions.act_window">
        <field name="name">Créer un lot de virement bancaire</field>
        <field name="res_model">bank.transfer.batch.wizard.step1</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{'dialog_size': 'medium'}</field>
    </record>

    <!-- Vue liste des versions pour sélection -->
    <record id="view_hr_version_bank_transfer_selection_list" model="ir.ui.view">
        <field name="name">hr.version.bank.transfer.selection.list</field>
        <field name="model">hr.version</field>
        <field name="arch" type="xml">
            <list string="Sélectionnez les employés" 
                  default_order="date_version DESC" 
                  create="0" 
                  delete="0" 
                  js_class="bank_transfer_version_list">
                <field name="employee_id" optional="show" widget="many2one_avatar_employee"/>
                <field name="date_version" readonly="1" string="Date effective"/>
                <field name="contract_date_start" string="Début contrat" optional="hide"/>
                <field name="contract_date_end" string="Fin contrat" optional="hide"/>
                <field name="currency_id" column_invisible="1"/>
                <field name="wage" widget="monetary" optional="show" string="Salaire"/>
                <field name="contract_type_id" optional="hide" string="Type de contrat"/>
                <field name="structure_type_id" optional="hide" string="Type de structure"/>
                <field name="job_id" optional="show" string="Poste"/>
                <field name="department_id" optional="show" string="Département"/>
                <field name="hr_responsible_id" optional="hide" string="Responsable RH"/>
                <field name="resource_calendar_id" optional="hide" string="Horaire"/>
                <field name="company_id" groups="base.group_multi_company" readonly="1" optional="hide"/>
            </list>
        </field>
    </record>

    <!-- Action pour ouvrir la liste de sélection des versions -->
    <record id="action_hr_version_bank_transfer_selection" model="ir.actions.act_window">
        <field name="name">Sélectionnez les employés</field>
        <field name="res_model">hr.version</field>
        <field name="view_mode">list</field>
        <field name="view_id" ref="view_hr_version_bank_transfer_selection_list"/>
        <field name="domain">[('active', '=', True)]</field>
        <field name="target">new</field>
        <field name="context">{
            'dialog_size': 'extra-large',
        }</field>
    </record>
</odoo>
